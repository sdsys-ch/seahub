"use strict";(self.webpackChunkseahub_frontend=self.webpackChunkseahub_frontend||[]).push([[319],{91188:function(e,t,i){var a=i(15671),s=i(43144),n=i(60136),r=i(29388),o=i(47313),l=i(42995),c=i(12756),d=i(12213),h=i(61805),p=i(46417),u=function(e){(0,n.Z)(i,e);var t=(0,r.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,s.Z)(i,[{key:"render",value:function(){var e=this.props,t=e.type,i=e.asyncOperationProgress,a=e.asyncOperatedFilesLength,s="move"===t?(0,h.ih)("Move {num} items"):(0,h.ih)("Copy {num} items");s=s.replace("{num}",a);var n={width:i+"%",lineHeight:"40px",textAlign:"left"};return(0,p.jsxs)(l.Z,{isOpen:!0,toggle:this.props.toggleDialog,children:[(0,p.jsx)(c.Z,{toggle:this.props.toggleDialog,children:s}),(0,p.jsx)(d.Z,{style:{minHeight:"80px"},children:(0,p.jsx)("div",{className:"progress",style:{height:"40px"},children:(0,p.jsx)("div",{className:"progress-bar pl-2",role:"progressbar",style:n,"aria-valuenow":i,"aria-valuemin":"0","aria-valuemax":"100",children:i+"%"})})})]})}}]),i}(o.Component);t.Z=u},59938:function(e,t,i){var a=i(15671),s=i(43144),n=i(60136),r=i(29388),o=i(47313),l=i(61805),c=i(95076),d=(i(95488),i(46417)),h=function(e){(0,n.Z)(i,e);var t=(0,r.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,s.Z)(i,[{key:"render",value:function(){var e=this.props.imageItems,t=this.props.imageIndex,i=e.length,a=e[t].name,s="".concat(a," (").concat(t+1,"/").concat(i,")");return(0,d.jsx)(c.Z,{imageTitle:s,mainSrc:e[t].src,nextSrc:e[(t+1)%i].src,prevSrc:e[(t+i-1)%i].src,onCloseRequest:this.props.closeImagePopup,onMovePrevRequest:this.props.moveToPrevImage,onMoveNextRequest:this.props.moveToNextImage,imagePadding:70,imageLoadErrorMessage:(0,l.ih)("The image could not be loaded."),prevLabel:(0,l.ih)("Previous (Left arrow key)"),nextLabel:(0,l.ih)("Next (Right arrow key)"),closeLabel:(0,l.ih)("Close (Esc)"),zoomInLabel:(0,l.ih)("Zoom in"),zoomOutLabel:(0,l.ih)("Zoom out")})}}]),i}(o.Component);t.Z=h},23396:function(e,t,i){var a,s=i(15671),n=i(43144),r=i(60136),o=i(29388),l=i(47313),c=i(42995),d=i(12756),h=i(12213),p=i(61805),u=i(4514),m=i(83854),g=i(51282),f=i(46417),v=function(e){(0,r.Z)(i,e);var t=(0,o.Z)(i);function i(e){var n;return(0,s.Z)(this,i),(n=t.call(this,e)).queryZipProgress=function(){var e=n.state.zipToken;u.I.queryZipProgress(e).then((function(t){var i=t.data;if(1==i.failed){var s;switch(clearInterval(a),i.failed_reason){case"size too large":s=(0,p.ih)("Failed to download. The total size of the files exceeded the limit.");break;case"internal error":s=(0,p.ih)("Internal Server Error");break;default:s=(0,p.ih)("Error")}n.setState({isLoading:!1,errorMsg:s})}else n.setState({zipProgress:0==i.total?"100%":(i.zipped/i.total*100).toFixed(2)+"%"}),i.total==i.zipped&&(clearInterval(a),n.props.toggleDialog(),location.href="".concat(p.gc,"zip/").concat(e))})).catch((function(e){clearInterval(a);var t=m.c.getErrorMsg(e);n.setState({isLoading:!1,errorMsg:t})}))},n.cancelZipTask=function(){var e=n.state.zipToken;u.I.cancelZipTask(e).then((function(e){})).catch((function(e){}))},n.toggleDialog=function(){var e=n.state.zipProgress;e&&"100%"!=e&&(clearInterval(a),n.cancelZipTask()),n.props.toggleDialog()},n.state={isLoading:!0,errorMsg:"",zipProgress:null},n}return(0,n.Z)(i,[{key:"componentDidMount",value:function(){var e=this,t=this.props,i=t.token,s=t.path,n=t.repoID,r=t.target;(i?r.length?u.I.getShareLinkDirentsZipTask(i,s,r):u.I.getShareLinkZipTask(i,s):u.I.zipDownload(n,s,r)).then((function(t){var i=t.data.zip_token;e.setState({isLoading:!1,errorMsg:"",zipToken:i}),e.queryZipProgress(),a=setInterval(e.queryZipProgress,1e3)})).catch((function(t){var i=m.c.getErrorMsg(t);e.setState({isLoading:!1,errorMsg:i})}))}},{key:"render",value:function(){return(0,f.jsxs)(c.Z,{isOpen:!0,toggle:this.toggleDialog,children:[(0,f.jsx)(d.Z,{toggle:this.toggleDialog,children:(0,p.ih)("Download")}),(0,f.jsx)(h.Z,{children:(0,f.jsx)(x,{data:this.state})})]})}}]),i}(l.Component),x=function(e){(0,r.Z)(i,e);var t=(0,o.Z)(i);function i(){return(0,s.Z)(this,i),t.apply(this,arguments)}return(0,n.Z)(i,[{key:"render",value:function(){var e=this.props.data,t=e.isLoading,i=e.errorMsg,a=e.zipProgress;return t?(0,f.jsx)(g.Z,{}):i?(0,f.jsxs)("div",{className:"text-center mt-7 mb-8",children:[(0,f.jsx)("img",{src:"".concat(p.si,"img/error-tip.png"),alt:"",width:"100"}),(0,f.jsx)("p",{className:"mt-3",children:i})]}):(0,f.jsx)("p",{className:"mt-4 text-center",children:"".concat((0,p.ih)("Packaging...")," ").concat(a)})}}]),i}(l.Component);t.Z=v},43916:function(e,t,i){i.d(t,{Z:function(){return D}});var a=i(15671),s=i(43144),n=i(60136),r=i(29388),o=i(47313),l=i(68164),c=i(42995),d=i(12756),h=i(12213),p=i(7764),u=i(21303),m=i(70816),g=i.n(m),f=i(61805),v=i(4514),x=i(83854),j=i(68396),b=i(46417),S=function(e){(0,n.Z)(i,e);var t=(0,r.Z)(i);function i(e){var s;return(0,a.Z)(this,i),(s=t.call(this,e)).onFileTagChanged=function(e){var t=e.parent_path,i={name:e.filename},a="/"===t?t+e.filename:t+"/"+e.filename;s.props.onFileTagChanged(i,a)},s.onDeleteTaggedFile=function(e){var t=s.props.repoID,i=e.file_tag_id;v.I.deleteFileTag(t,i).then((function(t){s.getTaggedFiles(),s.props.updateUsedRepoTags(),s.props.onFileTagChanged&&!e.file_deleted&&s.onFileTagChanged(e)})).catch((function(e){var t=x.c.getErrorMsg(e);j.Z.danger(t)}))},s.getTaggedFiles=function(){var e=s.props,t=e.repoID,i=e.currentTag,a=e.shareLinkToken;(a?v.I.getShareLinkTaggedFiles(a,i.id):v.I.listTaggedFiles(t,i.id)).then((function(e){var t=[];void 0!==e.data.tagged_files&&e.data.tagged_files.forEach((function(e){var i=e;t.push(i)})),s.setState({taggedFileList:t})})).catch((function(e){var t=x.c.getErrorMsg(e);j.Z.danger(t)}))},s.state={taggedFileList:[]},s}return(0,s.Z)(i,[{key:"componentDidMount",value:function(){this.getTaggedFiles()}},{key:"render",value:function(){var e=this,t=this.state.taggedFileList;return(0,b.jsxs)(c.Z,{isOpen:!0,style:{maxWidth:"678px"},children:[(0,b.jsx)(d.Z,{toggle:this.props.onClose,children:(0,f.ih)("Tagged Files")}),(0,b.jsx)(h.Z,{className:"dialog-list-container",children:(0,b.jsxs)("table",{children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{width:"50%",className:"ellipsis",children:(0,f.ih)("Name")}),(0,b.jsx)("th",{width:"20%",children:(0,f.ih)("Size")}),(0,b.jsx)("th",{width:"22%",children:(0,f.ih)("Last Update")}),(0,b.jsx)("th",{width:"8%"})]})}),(0,b.jsx)("tbody",{children:t.map((function(t,i){return(0,b.jsx)(F,{repoID:e.props.repoID,taggedFile:t,onDeleteTaggedFile:e.onDeleteTaggedFile,shareLinkToken:e.props.shareLinkToken,enableFileDownload:e.props.enableFileDownload},i)}))})]})}),(0,b.jsx)(p.Z,{children:(0,b.jsx)(u.Z,{color:"secondary",onClick:this.props.toggleCancel,children:(0,f.ih)("Close")})})]})}}]),i}(o.Component),F=function(e){(0,n.Z)(i,e);var t=(0,r.Z)(i);function i(e){var s;return(0,a.Z)(this,i),(s=t.call(this,e)).onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.setState({active:!1})},s.deleteFile=function(e){e.preventDefault(),s.props.onDeleteTaggedFile(s.props.taggedFile)},s.state={active:!1},s}return(0,s.Z)(i,[{key:"render",value:function(){var e=this.props,t=e.taggedFile,i=e.shareLinkToken,a=e.enableFileDownload,s=t.parent_path?x.c.joinPath(t.parent_path,t.filename):"",n=i?f.ze+"d/"+i+"/files/?p="+x.c.encodePath(s):f.ze+"lib/"+this.props.repoID+"/file"+x.c.encodePath(s);return(0,b.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onMouseEnter,children:[t.file_deleted?(0,b.jsx)(o.Fragment,{children:(0,b.jsxs)("td",{colSpan:"3",className:"name",children:[t.filename," ",(0,b.jsx)("span",{style:{color:"red"},children:(0,f.ih)("deleted")})]})}):(0,b.jsxs)(o.Fragment,{children:[(0,b.jsx)("td",{children:(0,b.jsx)("a",{href:n,target:"_blank",className:"d-inline-block w-100 ellipsis",title:t.filename,rel:"noreferrer",children:t.filename})}),(0,b.jsx)("td",{children:x.c.bytesToSize(t.size)}),(0,b.jsx)("td",{children:g().unix(t.mtime).fromNow()})]}),(0,b.jsxs)("td",{children:[!i&&(0,b.jsx)("a",{href:"#",role:"button","aria-label":(0,f.ih)("Delete"),title:(0,f.ih)("Delete"),className:"action-icon sf2-icon-x3".concat(this.state.active?"":" invisible"),onClick:this.deleteFile}),i&&a&&(0,b.jsx)("a",{className:"action-icon sf2-icon-download".concat(this.state.active?"":" invisible"),href:"".concat(n,"&dl=1"),title:(0,f.ih)("Download"),"aria-label":(0,f.ih)("Download")})]})]})}}]),i}(o.Component),k=i(14658),I=(0,s.Z)((function e(t){(0,a.Z)(this,e),this.created=t.created_at,this.createdStr=g()(new Date(t.created_at).getTime()).format("YYYY-MM-DD HH:mm"),this.id=t.id,this.ownerNickname=t.owner_nickname,this.originRepoID=t.origin_repo_id,this.draftFilePath=t.draft_file_path})),w=function(e){(0,n.Z)(i,e);var t=(0,r.Z)(i);function i(e){var s;return(0,a.Z)(this,i),(s=t.call(this,e)).onDeleteDraftItem=function(e){k.Z.deleteDraft(e.id).then((function(){var t=s.state.drafts.filter((function(t){return t.id!==e.id}));s.setState({drafts:t});var i=(0,f.ih)("Successfully deleted draft %(draft)s.");i=i.replace("%(draft)s",e.draftFilePath),j.Z.success(i)})).catch((function(){var t=(0,f.ih)("Failed to delete draft %(draft)s.");t=t.replace("%(draft)s",e.draftFilePath),j.Z.danger(t)}))},s.toggle=function(){s.props.toggle()},s.state={drafts:[]},s}return(0,s.Z)(i,[{key:"componentDidMount",value:function(){var e=this;v.I.listRepoDrafts(this.props.repoID).then((function(t){var i=t.data.drafts.map((function(e){return new I(e)}));e.setState({drafts:i})}))}},{key:"render",value:function(){var e=this;return(0,b.jsxs)(c.Z,{isOpen:!0,toggle:this.toggle,children:[(0,b.jsx)(d.Z,{toggle:this.toggle,children:(0,f.ih)("Drafts")}),(0,b.jsx)(h.Z,{className:"dialog-list-container",children:(0,b.jsxs)("table",{children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{width:"50%",className:"ellipsis",children:(0,f.ih)("Name")}),(0,b.jsx)("th",{width:"20%",children:(0,f.ih)("Owner")}),(0,b.jsx)("th",{width:"20%",children:(0,f.ih)("Last Update")}),(0,b.jsx)("th",{width:"10%"})]})}),(0,b.jsx)("tbody",{children:this.state.drafts.map((function(t,i){return(0,b.jsx)(C,{draftItem:t,onDeleteDraftItem:e.onDeleteDraftItem},i)}))})]})}),(0,b.jsx)(p.Z,{children:(0,b.jsx)(u.Z,{color:"secondary",onClick:this.toggle,children:(0,f.ih)("Close")})})]})}}]),i}(o.Component),C=function(e){(0,n.Z)(i,e);var t=(0,r.Z)(i);function i(e){var s;return(0,a.Z)(this,i),(s=t.call(this,e)).onMouseEnter=function(){s.setState({active:!0})},s.onMouseLeave=function(){s.setState({active:!1})},s.state={active:!1},s}return(0,s.Z)(i,[{key:"render",value:function(){var e=this.props.draftItem,t=f.ze+"drafts/"+e.id+"/",i=this.state.active?"action-icon sf2-icon-x3":"action-icon vh sf2-icon-x3";return(0,b.jsxs)("tr",{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[(0,b.jsx)("td",{className:"name",children:(0,b.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",children:x.c.getFileName(e.draftFilePath)})}),(0,b.jsx)("td",{children:e.ownerNickname}),(0,b.jsx)("td",{children:g()(e.createdStr).fromNow()}),(0,b.jsx)("td",{children:(0,b.jsx)("i",{className:i,onClick:this.props.onDeleteDraftItem.bind(this,e)})})]})}}]),i}(o.Component),D=function(e){(0,n.Z)(i,e);var t=(0,r.Z)(i);function i(e){var s;return(0,a.Z)(this,i),(s=t.call(this,e)).onListTaggedFiles=function(e){s.setState({currentTag:e,isListTaggedFileShow:!s.state.isListTaggedFileShow})},s.onCloseDialog=function(){s.setState({isListTaggedFileShow:!1})},s.toggleDrafts=function(){s.setState({showRepoDrafts:!s.state.showRepoDrafts})},s.state={currentTag:null,isListTaggedFileShow:!1,showRepoDrafts:!1},s}return(0,s.Z)(i,[{key:"render",value:function(){var e=this,t=this.props,i=t.repoID,a=t.usedRepoTags,s=t.draftCounts,n=t.className;return void 0===s&&(s=0),(0,b.jsxs)("div",{className:"repo-info-bar ".concat(n||""),children:[a.length>0&&(0,b.jsx)("ul",{className:"used-tag-list",children:a.map((function(t){return(0,b.jsxs)("li",{className:"used-tag-item",children:[(0,b.jsx)("span",{className:"used-tag",style:{backgroundColor:t.color}}),(0,b.jsx)("span",{className:"used-tag-name",title:t.name,children:t.name}),(0,b.jsx)("button",{type:"button",className:"used-tag-files border-0 bg-transparent",onClick:e.onListTaggedFiles.bind(e,t),children:t.fileCount>1?t.fileCount+" files":t.fileCount+" file"})]},t.id)}))}),this.state.isListTaggedFileShow&&(0,b.jsx)(l.Z,{children:(0,b.jsx)(S,{repoID:i,currentTag:this.state.currentTag,onClose:this.onCloseDialog,toggleCancel:this.onListTaggedFiles,updateUsedRepoTags:this.props.updateUsedRepoTags,onFileTagChanged:this.props.onFileTagChanged,shareLinkToken:this.props.shareLinkToken,enableFileDownload:this.props.enableFileDownload})}),this.state.showRepoDrafts&&(0,b.jsx)(l.Z,{children:(0,b.jsx)(w,{toggle:this.toggleDrafts,repoID:this.props.repoID})})]})}}]),i}(o.Component)},14472:function(e,t,i){var a=i(74165),s=i(15861),n=i(15671),r=i(43144),o=i(97326),l=i(60136),c=i(29388),d=i(47313),h=i(92534),p=i.n(h),u=i(1168),m=i(21303),g=i(13380),f=i(25417),v=i(57124),x=i(48128),j=i(70816),b=i.n(j),S=i(93190),F=i(61805),k=i(83854),I=i(4514),w=i(51282),C=i(68396),D=i(68164),y=i(23396),Z=i(59938),N=i(93433),U=i(57313),P=i.n(U),L=i(46417),M="uploading",_="error",O="isSaving",z="uploaded",T=function(e){(0,l.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).onUploadCancel=function(e){e.preventDefault(),a.props.onUploadCancel(a.props.resumableFile)},a.onUploadRetry=function(e){e.preventDefault(),a.props.onUploadRetry(a.props.resumableFile)},a.formatFileSize=function(e){return"number"!==typeof e?"":e>=1e9?(e/1e9).toFixed(1)+" G":e>=1e6?(e/1e6).toFixed(1)+" M":e>=1e3?(e/1e3).toFixed(1)+" K":e.toFixed(1)+" B"},a.state={uploadState:M},a}return(0,r.Z)(i,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.resumableFile,i=M;t.error?i=_:(0!==t.remainingTime||t.isSaved||(i=O),t.isSaved&&(i=z)),this.setState({uploadState:i})}},{key:"render",value:function(){var e=this.props.resumableFile,t=Math.round(100*e.progress()),i=e.error,a=e.newFileName,s=this.formatFileSize(e.size);return(0,L.jsxs)("tr",{className:"file-upload-item",children:[(0,L.jsx)("td",{className:"upload-name",children:(0,L.jsx)("div",{className:"ellipsis",title:a,children:a})}),(0,L.jsx)("td",{className:"ellipsis",children:(0,L.jsx)("span",{className:"file-size",title:s,children:s})}),(0,L.jsxs)("td",{className:"upload-progress ellipsis",children:[(this.state.uploadState===M||this.state.uploadState===O)&&(0,L.jsxs)(d.Fragment,{children:[e.size>=1e8&&(0,L.jsxs)(d.Fragment,{children:[e.isUploading()&&(0,L.jsxs)("div",{className:"progress-container",children:[(0,L.jsx)("div",{className:"progress",children:(0,L.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})}),-1===e.remainingTime&&(0,L.jsx)("div",{className:"progress-text",children:(0,F.ih)("Preparing to upload...")}),e.remainingTime>0&&(0,L.jsxs)("div",{className:"progress-text",children:[(0,F.ih)("Remaining")," ",k.c.formatTime(e.remainingTime)]}),0===e.remainingTime&&(0,L.jsx)("div",{className:"progress-text",children:(0,F.ih)("Indexing...")})]}),!e.isUploading()&&(0,L.jsx)("div",{className:"progress-container d-flex align-items-center",children:(0,L.jsx)("div",{className:"progress",children:(0,L.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})})]}),e.size<1e8&&(0,L.jsx)("div",{className:"progress-container d-flex align-items-center",children:(0,L.jsx)("div",{className:"progress",children:(0,L.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})})]}),this.state.uploadState===_&&(0,L.jsx)("div",{className:"message err-message ml-0",dangerouslySetInnerHTML:{__html:i}})]}),(0,L.jsx)("td",{className:"upload-operation ellipsis",children:(0,L.jsxs)(d.Fragment,{children:[this.state.uploadState===M&&(0,L.jsx)("a",{href:"#",onClick:this.onUploadCancel,children:(0,F.ih)("Cancel")}),this.state.uploadState===_&&(0,L.jsx)("a",{href:"#",onClick:this.onUploadRetry,children:(0,F.ih)("Retry")}),this.state.uploadState===O&&(0,L.jsx)("span",{className:"saving",children:(0,F.ih)("Saving...")}),this.state.uploadState===z&&(0,L.jsx)("span",{className:"uploaded",children:(0,F.ih)("Uploaded")})]})})]})}}]),i}(d.Component),R=function(e){(0,l.Z)(i,e);var t=(0,c.Z)(i);function i(){return(0,n.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"render",value:function(){var e=this.props.file,t=(0,F.ih)("Please upload files less than {placeholder}M").replace("{placeholder}",F.Og);return(0,L.jsxs)("tr",{className:"file-upload-item",children:[(0,L.jsx)("td",{className:"upload-name",children:(0,L.jsx)("div",{className:"ellipsis",title:e.name,children:e.name})}),(0,L.jsx)("td",{colSpan:3,className:"error",children:t})]})}}]),i}(d.Component),E=R,A=function(e){(0,l.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).onCancelAllUploading=function(){a.props.onCancelAllUploading()},a.onMinimizeUpload=function(e){e.nativeEvent.stopImmediatePropagation(),a.setState({isMinimized:!a.state.isMinimized})},a.onCloseUpload=function(e){e.nativeEvent.stopImmediatePropagation(),a.props.onCloseUploadDialog()},a.state={isMinimized:!1},a}return(0,r.Z)(i,[{key:"render",value:function(){var e=this,t=k.c.formatBitRate(this.props.uploadBitrate),i=(0,F.ih)("File Upload"),a=(0,F.ih)("File Uploading...")+" "+this.props.totalProgress+"% ("+t+")",s=(0,L.jsx)("span",{className:"sf2-icon-minus",onClick:this.onMinimizeUpload}),n=(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)("span",{className:"sf2-icon-minus",onClick:this.onMinimizeUpload}),(0,L.jsx)("span",{className:"sf2-icon-x1",onClick:this.onCloseUpload})]}),r=this.props,o=r.totalProgress,l=r.allFilesUploaded,c=r.retryFileList;return(0,L.jsxs)("div",{className:"uploader-list-view mw-100",style:{height:this.state.isMinimized?"2.25rem":"20rem"},children:[(0,L.jsxs)("div",{className:"uploader-list-header",children:[(0,L.jsx)("div",{className:"title",children:100===o?i:a}),(0,L.jsx)("div",{className:"uploader-options",children:100===o||l?n:s})]}),(0,L.jsxs)("div",{className:"uploader-list-content",children:[(0,L.jsxs)("div",{className:"text-right mt-2",children:[c.length>0?(0,L.jsx)("span",{className:"cursor-pointer",onClick:this.props.onUploadRetryAll,children:(0,F.ih)("Retry All")}):(0,L.jsx)("span",{className:"cursor-pointer disabled-link",children:(0,F.ih)("Retry All")}),l?(0,L.jsx)("span",{className:"cursor-pointer ml-3 disabled-link",children:(0,F.ih)("Cancel All")}):(0,L.jsx)("span",{className:"cursor-pointer ml-3",onClick:this.onCancelAllUploading,children:(0,F.ih)("Cancel All")})]}),(0,L.jsxs)("table",{className:"table-thead-hidden",children:[(0,L.jsx)("thead",{children:(0,L.jsxs)("tr",{children:[(0,L.jsx)("th",{width:"30%",children:(0,F.ih)("name")}),(0,L.jsx)("th",{width:"20%",children:(0,F.ih)("size")}),(0,L.jsx)("th",{width:"30%",children:(0,F.ih)("progress")}),(0,L.jsx)("th",{width:"20%",children:(0,F.ih)("state")})]})}),(0,L.jsxs)("tbody",{children:[this.props.forbidUploadFileList.map((function(e,t){return(0,L.jsx)(E,{file:e},t)})),this.props.uploadFileList.map((function(t,i){return(0,L.jsx)(T,{resumableFile:t,onUploadCancel:e.props.onUploadCancel,onUploadRetry:e.props.onUploadRetry},i)}))]})]})]})]})}}]),i}(d.Component),B=(i(87575),function(e){(0,l.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).componentWillUnmount=function(){window.onbeforeunload=null,!0===a.props.dragAndDrop&&a.resumable.disableDropOnDocument()},a.onbeforeunload=function(){if(window.uploader&&window.uploader.isUploadProgressDialogShow&&100!==window.uploader.totalProgress)return""},a.bindCallbackHandler=function(){var e=a.props,t=e.minFileSizeErrorCallback,i=e.fileTypeErrorCallback;a.maxFilesErrorCallback&&(a.resumable.opts.maxFilesErrorCallback=a.maxFilesErrorCallback),t&&(a.resumable.opts.minFileSizeErrorCallback=a.props.minFileSizeErrorCallback),a.maxFileSizeErrorCallback&&(a.resumable.opts.maxFileSizeErrorCallback=a.maxFileSizeErrorCallback),i&&(a.resumable.opts.fileTypeErrorCallback=a.props.fileTypeErrorCallback)},a.bindEventHandler=function(){a.resumable.on("chunkingComplete",a.onChunkingComplete.bind((0,o.Z)(a))),a.resumable.on("fileAdded",a.onFileAdded.bind((0,o.Z)(a))),a.resumable.on("filesAddedComplete",a.filesAddedComplete.bind((0,o.Z)(a))),a.resumable.on("fileProgress",a.onFileProgress.bind((0,o.Z)(a))),a.resumable.on("fileSuccess",a.onFileUploadSuccess.bind((0,o.Z)(a))),a.resumable.on("progress",a.onProgress.bind((0,o.Z)(a))),a.resumable.on("complete",a.onComplete.bind((0,o.Z)(a))),a.resumable.on("pause",a.onPause.bind((0,o.Z)(a))),a.resumable.on("fileRetry",a.onFileRetry.bind((0,o.Z)(a))),a.resumable.on("fileError",a.onFileError.bind((0,o.Z)(a))),a.resumable.on("error",a.onError.bind((0,o.Z)(a))),a.resumable.on("beforeCancel",a.onBeforeCancel.bind((0,o.Z)(a))),a.resumable.on("cancel",a.onCancel.bind((0,o.Z)(a))),a.resumable.on("dragstart",a.onDragStart.bind((0,o.Z)(a)))},a.maxFilesErrorCallback=function(e,t){var i=F.dd,a=(0,F.ih)("Please upload no more than {maxFiles} files at a time.");a=a.replace("{maxFiles}",i),C.Z.danger(a)},a.maxFileSizeErrorCallback=function(e){var t=a.state.forbidUploadFileList;t.push(e),a.setState({forbidUploadFileList:t})},a.onChunkingComplete=function(e){!0===a.state.allFilesUploaded&&a.setState({allFilesUploaded:!1});var t="/"===a.props.path?"/":a.props.path+"/",i=e.fileName,s=e.relativePath,n=i===s;if(e.formData={},n)e.formData={parent_dir:t};else{var r=s.slice(0,s.lastIndexOf("/")+1);e.formData={parent_dir:t,relative_path:r}}},a.onFileAdded=function(e,t){if(e.fileName===e.relativePath&&1===t.length){a.setUploadFileList(a.resumable.files);var i=a.props,s=i.token,n=i.relativePath;I.I.sharedLinkGetFileUploadUrl(s,n).then((function(t){a.resumable.opts.target=t.data.upload_link+"?ret-json=1",a.resumableUpload(e)})).catch((function(e){var t=k.c.getErrorMsg(e);C.Z.danger(t)}))}else if(a.setUploadFileList(a.resumable.files),!a.isUploadLinkLoaded){a.isUploadLinkLoaded=!0;var r=a.props,o=r.token,l=r.relativePath;I.I.sharedLinkGetFileUploadUrl(o,l).then((function(e){a.resumable.opts.target=e.data.upload_link+"?ret-json=1",a.resumable.upload()})).catch((function(e){var t=k.c.getErrorMsg(e);C.Z.danger(t)}))}},a.resumableUpload=function(e){var t=a.props,i=t.repoID,s=t.path;I.I.getFileUploadedBytes(i,s,e.fileName).then((function(t){var i=t.data.uploadedBytes,s=1024*parseInt(F.pL)*1024||1048576,n=Math.floor(i/s);e.markChunksCompleted(n),a.resumable.upload()})).catch((function(e){var t=k.c.getErrorMsg(e);C.Z.danger(t)}))},a.filesAddedComplete=function(e,t){a.state.forbidUploadFileList.length>0&&0===t.length&&a.setState({isUploadProgressDialogShow:!0,totalProgress:100})},a.setUploadFileList=function(){var e=a.resumable.files;a.setState({uploadFileList:e,isUploadProgressDialogShow:!0}),k.c.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)},a.onFileProgress=function(e){var t=a.getBitrate(),i=a.state.uploadFileList.map((function(i){if(i.uniqueIdentifier===e.uniqueIdentifier&&t){var a=8*(i.size-i.size*i.progress()),s=Math.floor(a/t);i.remainingTime=s}return i}));a.setState({uploadBitrate:t,uploadFileList:i})},a.getBitrate=function(){var e=0,t=0,i=(new Date).getTime();if(a.resumable.files.forEach((function(t){e+=t.progress()*t.size})),a.timestamp){var s=i-a.timestamp;if(s<a.bitrateInterval)return a.state.uploadBitrate;(e<a.loaded||0===a.loaded)&&(a.loaded=e),t=(e-a.loaded)*(1e3/s)*8}return a.timestamp=i,a.loaded=e,t},a.onProgress=function(){var e=Math.round(100*a.resumable.progress());a.setState({totalProgress:e}),k.c.registerGlobalVariable("uploader","totalProgress",e)},a.onFileUploadSuccess=function(e,t){var i=e.formData,s=(new Date).getTime()/1e3;t=i.replace?t:JSON.parse(t)[0],i.relative_path;var n={id:t.id,type:"file",name:t.name,size:t.size,mtime:s};a.props.onFileUploadSuccess(n);var r=a.state.uploadFileList.map((function(i){return i.uniqueIdentifier===e.uniqueIdentifier&&(i.newFileName=t.name,i.isSaved=!0),i}));a.setState({uploadFileList:r})},a.onFileError=function(e,t){var i="";if(t){var s=t.replace(/\n/g,"");s=JSON.parse(s),"File locked by others."===(i=s.error)&&(i=(0,F.ih)("File is locked by others.")),"Internal error."===i&&(i=(0,F.ih)("Internal Server Error"))}else i=(0,F.ih)("Network error");var n=a.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(a.state.retryFileList.push(t),t.error=i),t}));a.loaded=0,a.setState({retryFileList:a.state.retryFileList,uploadFileList:n})},a.onComplete=function(){a.notifiedFolders=[],a.isUploadLinkLoaded=!1,a.setState({allFilesUploaded:!0})},a.onPause=function(){},a.onError=function(e){a.isUploadLinkLoaded=!1,k.c.registerGlobalVariable("uploader","totalProgress",100)},a.onFileRetry=function(){},a.onBeforeCancel=function(){},a.onCancel=function(){},a.setHeaders=function(e,t){var i=t.offset,a=t.getOpt("chunkSize"),s=0===e.size?1:e.size,n=0!==i?i*a:0,r=Math.min(s,(i+1)*a)-1;return s-t.endByte<a&&!t.getOpt("forceChunkSize")&&(r=s),{Accept:"application/json; text/javascript, */*; q=0.01","Content-Disposition":'attachment; filename="'+encodeURI(e.fileName)+'"',"Content-Range":"bytes "+n+"-"+r+"/"+s}},a.setQuery=function(e){return e.formData},a.generateUniqueIdentifier=function(e){var t=e.webkitRelativePath||e.relativePath||e.fileName||e.name;return p()(t+new Date)+t},a.onClick=function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},a.onFileUpload=function(){a.uploadInput.current.removeAttribute("webkitdirectory"),a.uploadInput.current.click()},a.onFolderUpload=function(){a.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory"),a.uploadInput.current.click()},a.onDragStart=function(){a.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory")},a.onCloseUploadDialog=function(){a.loaded=0,a.resumable.files=[],a.isUploadLinkLoaded=!1,a.setState({isUploadProgressDialogShow:!1,uploadFileList:[],forbidUploadFileList:[]}),k.c.registerGlobalVariable("uploader","isUploadProgressDialogShow",!1)},a.onUploadCancel=function(e){var t=a.state.uploadFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier||(t.cancel(),!1)}));a.resumable.isUploading()||(a.setState({totalProgress:"100",allFilesUploaded:!0}),a.loaded=0),a.setState({uploadFileList:t})},a.onCancelAllUploading=function(){var e=a.state.uploadFileList.filter((function(e){return!Math.round(1!==e.progress())||(e.cancel(),!1)}));a.loaded=0,a.setState({allFilesUploaded:!0,totalProgress:"100",uploadFileList:e}),a.isUploadLinkLoaded=!1},a.onUploadRetry=function(e){var t=a.props,i=t.token,s=t.relativePath;I.I.sharedLinkGetFileUploadUrl(i,s).then((function(t){a.resumable.opts.target=t.data.upload_link+"?ret-json=1";var i=a.state.retryFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier})),s=a.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(t.error=null,a.retryUploadFile(t)),t}));a.setState({retryFileList:i,uploadFileList:s})})).catch((function(e){var t=k.c.getErrorMsg(e);C.Z.danger(t)}))},a.onUploadRetryAll=function(){var e=a.props,t=e.token,i=e.relativePath;I.I.sharedLinkGetFileUploadUrl(t,i).then((function(e){a.resumable.opts.target=e.data.upload_link+"?ret-json=1",a.state.retryFileList.forEach((function(e){e.error=!1,a.retryUploadFile(e)}));var t=a.state.uploadFileList.slice(0);a.setState({retryFileList:[],uploadFileList:t})})).catch((function(e){var t=k.c.getErrorMsg(e);C.Z.danger(t)}))},a.retryUploadFile=function(e){var t=a.props,i=t.repoID,s=t.path,n=e.fileName;if(!(e.fileName===e.relativePath)){var r=e.formData.relative_path;n=("/"===s?s+r:s+"/"+r)+n}e.bootstrap();var o=!1;e.resumableObj.on("chunkingComplete",(function(){o||I.I.getFileUploadedBytes(i,s,n).then((function(t){var i=t.data.uploadedBytes,a=1024*parseInt(F.pL)*1024||1048576,s=Math.floor(i/a);e.markChunksCompleted(s),e.resumableObj.upload()})).catch((function(e){var t=k.c.getErrorMsg(e);C.Z.danger(t)})),o=!0}))},a.uploadFile=function(){var e=a.resumable.files[a.resumable.files.length-1],t=a.props,i=t.token,s=t.relativePath;I.I.sharedLinkGetFileUploadUrl(i,s).then((function(t){a.resumable.opts.target=t.data.upload_link+"?ret-json=1",a.setState({isUploadRemindDialogShow:!1,isUploadProgressDialogShow:!0,uploadFileList:[].concat((0,N.Z)(a.state.uploadFileList),[e])},(function(){a.resumable.upload()})),k.c.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)})).catch((function(e){var t=k.c.getErrorMsg(e);C.Z.danger(t)}))},a.cancelFileUpload=function(){a.resumable.files.pop(),a.setState({isUploadRemindDialogShow:!1})},a.state={retryFileList:[],uploadFileList:[],forbidUploadFileList:[],totalProgress:0,isUploadProgressDialogShow:!1,isUploadRemindDialogShow:!1,currentResumableFile:null,uploadBitrate:0,allFilesUploaded:!1},a.uploadInput=d.createRef(),a.notifiedFolders=[],a.timestamp=null,a.loaded=0,a.bitrateInterval=500,window.onbeforeunload=a.onbeforeunload,a.isUploadLinkLoaded=!1,a}return(0,r.Z)(i,[{key:"componentDidMount",value:function(){this.resumable=new(P())({target:"",query:this.setQuery||{},fileType:this.props.filetypes,maxFiles:F.dd||void 0,maxFileSize:1e3*F.Og*1e3||void 0,testMethod:this.props.testMethod||"post",testChunks:this.props.testChunks||!1,headers:this.setHeaders||{},withCredentials:this.props.withCredentials||!1,chunkSize:1024*parseInt(F.pL)*1024||1048576,simultaneousUploads:this.props.simultaneousUploads||1,fileParameterName:this.props.fileParameterName,generateUniqueIdentifier:this.generateUniqueIdentifier,forceChunkSize:!0,maxChunkRetries:3,minFileSize:0}),this.resumable.assignBrowse(this.uploadInput.current,!0),!0===this.props.dragAndDrop&&this.resumable.enableDropOnDocument(),this.bindCallbackHandler(),this.bindEventHandler()}},{key:"render",value:function(){return(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)("div",{className:"file-uploader-container",children:(0,L.jsx)("div",{className:"file-uploader",children:(0,L.jsx)("input",{className:"upload-input",type:"file",ref:this.uploadInput,onClick:this.onClick})})}),this.state.isUploadProgressDialogShow&&(0,L.jsx)(A,{retryFileList:this.state.retryFileList,uploadFileList:this.state.uploadFileList,forbidUploadFileList:this.state.forbidUploadFileList,totalProgress:this.state.totalProgress,uploadBitrate:this.state.uploadBitrate,allFilesUploaded:this.state.allFilesUploaded,onCloseUploadDialog:this.onCloseUploadDialog,onCancelAllUploading:this.onCancelAllUploading,onUploadCancel:this.onUploadCancel,onUploadRetry:this.onUploadRetry,onUploadRetryAll:this.onUploadRetryAll})]})}}]),i}(d.Component)),q=B,G=i(42995),H=i(12756),V=i(12213),Y=i(93869),Q=i(7764),W=i(62150),J=function(e){(0,l.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).onSaveSharedFile=function(){a.props.handleSaveSharedDir(a.state.repo.repo_id,a.state.selectedPath)},a.onDirentItemClick=function(e,t,i){"dir"===i.type?a.setState({repo:e,selectedPath:t}):a.setState({repo:null,selectedPath:""})},a.onRepoItemClick=function(e){a.setState({repo:e,selectedPath:"/"})},a.state={repo:null,selectedPath:"",errMessage:""},a}return(0,r.Z)(i,[{key:"render",value:function(){return(0,L.jsxs)(G.Z,{isOpen:!0,className:"sf-save-file",toggle:this.props.toggleCancel,children:[(0,L.jsx)(H.Z,{toggle:this.props.toggleCancel,children:(0,F.ih)("Save to:")}),(0,L.jsxs)(V.Z,{children:[(0,L.jsx)(W.Z,{isShowFile:!1,onDirentItemClick:this.onDirentItemClick,onRepoItemClick:this.onRepoItemClick,mode:"only_all_repos"}),this.state.errMessage&&(0,L.jsx)(Y.Z,{color:"danger",children:this.state.errMessage})]}),(0,L.jsxs)(Q.Z,{children:[(0,L.jsx)(m.Z,{color:"secondary",onClick:this.props.toggleCancel,children:(0,F.ih)("Cancel")}),this.state.selectedPath?(0,L.jsx)(m.Z,{color:"primary",onClick:this.onSaveSharedFile,children:(0,F.ih)("Submit")}):(0,L.jsx)(m.Z,{color:"primary",disabled:!0,children:(0,F.ih)("Submit")})]})]})}}]),i}(d.Component),$=i(91188),K=i(43916),X=i(69443);i(62012);b().locale(window.app.config.lang);var ee=window.app.pageOptions.name,te=window.shared.pageOptions,ie=te.token,ae=te.dirName,se=te.dirPath,ne=te.sharedBy,re=te.repoID,oe=te.relativePath,le=te.mode,ce=te.thumbnailSize,de=te.zipped,he=te.trafficOverLimit,pe=te.canDownload,ue=te.noQuota,me=te.canUpload,ge=te.enableVideoThumbnail,fe=!he&&pe,ve=function(e){(0,l.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).sortItems=function(e,t){a.setState({sortBy:e,sortOrder:t,items:k.c.sortDirentsInSharedDir(a.state.items,e,t)})},a.getThumbnails=function(){var e=a.state.items.filter((function(e){return!e.is_dir&&(k.c.imageCheck(e.file_name)||ge&&k.c.videoCheck(e.file_name))&&!e.encoded_thumbnail_src}));if(0!=e.length){var t=e.length,i=(0,o.Z)(a);!function a(s){var n=e[s];I.I.getShareLinkThumbnail(ie,n.file_path,ce).then((function(e){n.encoded_thumbnail_src=e.data.encoded_thumbnail_src})).catch((function(e){})).then((function(){s<t-1?a(++s):i.setState({items:i.state.items})}))}(0)}},a.renderPath=function(){return(0,L.jsxs)(d.Fragment,{children:[de.map((function(e,t){return t!=de.length-1?(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(e.path),"&mode=").concat(le),className:"mx-1 ellipsis",title:e.name,children:e.name}),(0,L.jsx)("span",{children:" / "})]},t):null})),(0,L.jsx)("span",{className:"ml-1 ellipsis",title:de[de.length-1].name,children:de[de.length-1].name})]})},a.zipDownloadFolder=function(e){F.Zb?I.I.getShareLinkZipTask(ie,e).then((function(e){var t=e.data.zip_token;location.href="".concat(F.gc,"zip/").concat(t)})).catch((function(e){var t=k.c.getErrorMsg(e);a.setState({isLoading:!1,errorMsg:t})})):a.setState({isZipDialogOpen:!0,zipFolderPath:e})},a.zipDownloadSelectedItems=function(){if(F.Zb){var e=a.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}));I.I.getShareLinkDirentsZipTask(ie,oe,e).then((function(e){var t=e.data.zip_token;location.href="".concat(F.gc,"zip/").concat(t)})).catch((function(e){var t=k.c.getErrorMsg(e);a.setState({isLoading:!1,errorMsg:t})}))}else a.setState({isZipDialogOpen:!0,zipFolderPath:oe,selectedItems:a.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}))})},a.saveSelectedItems=function(){a.setState({isSaveSharedDirDialogShow:!0,itemsForSave:a.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}))})},a.saveAllItems=function(){a.setState({isSaveSharedDirDialogShow:!0,itemsForSave:a.state.items.map((function(e){return e.file_name||e.folder_name}))})},a.toggleSaveSharedDirCancel=function(){a.setState({isSaveSharedDirDialogShow:!1,itemsForSave:[]})},a.handleSaveSharedDir=function(e,t){var i=a.state.itemsForSave;I.I.saveSharedDir(e,t,ie,oe,i).then((function(e){a.setState({isSaveSharedDirDialogShow:!1,itemsForSave:[],isCopyMoveProgressDialogShow:!0,asyncCopyMoveTaskId:e.data.task_id,asyncOperatedFilesLength:i.length},(function(){a.getAsyncCopyMoveProgress()}))})).catch((function(e){var t=k.c.getErrorMsg(e);a.setState({errMessage:t})}))},a.onProgressDialogToggle=function(){if(100!==a.state.asyncOperationProgress){var e=a.state.asyncCopyMoveTaskId;I.I.cancelCopyMoveOperation(e)}a.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1})},a.closeZipDialog=function(){a.setState({isZipDialogOpen:!1,zipFolderPath:"",selectedItems:[]})},a.prepareImageItem=function(e){var t=e.file_name,i="gif"==t.substr(t.lastIndexOf(".")+1).toLowerCase(),a="".concat(F.ze,"d/").concat(ie,"/files/?p=").concat(encodeURIComponent(e.file_path));return{name:t,url:a,src:i?"".concat(a,"&raw=1"):"".concat(F.ze,"thumbnail/").concat(ie,"/").concat(F.fp).concat(k.c.encodePath(e.file_path))}},a.showImagePopup=function(e){var t=a.state.items.filter((function(e){return!e.is_dir&&k.c.imageCheck(e.file_name)})),i=t.map((function(e){return a.prepareImageItem(e)}));a.setState({isImagePopupOpen:!0,imageItems:i,imageIndex:t.indexOf(e)})},a.closeImagePopup=function(){a.setState({isImagePopupOpen:!1})},a.moveToPrevImage=function(){var e=a.state.imageItems.length;a.setState((function(t){return{imageIndex:(t.imageIndex+e-1)%e}}))},a.moveToNextImage=function(){var e=a.state.imageItems.length;a.setState((function(t){return{imageIndex:(t.imageIndex+1)%e}}))},a.toggleAllSelected=function(){a.setState((function(e){return{isAllItemsSelected:!e.isAllItemsSelected,items:a.state.items.map((function(t){return t.isSelected=!e.isAllItemsSelected,t}))}}))},a.toggleItemSelected=function(e,t){a.setState({items:a.state.items.map((function(i){return i===e&&(i.isSelected=t),i}))},(function(){a.setState({isAllItemsSelected:!a.state.items.some((function(e){return!e.isSelected}))})}))},a.onUploadFile=function(e){e.nativeEvent.stopImmediatePropagation(),a.uploader.onFileUpload()},a.onFileUploadSuccess=function(e){var t=e.name,i=e.size,s={isSelected:!1,file_name:t,file_path:k.c.joinPath(oe,t),is_dir:!1,last_modified:b()().format(),size:i},n=a.state.items.filter((function(e){return e.is_dir})),r=Array.from(a.state.items);r.splice(n.length,0,s),a.setState({items:r}),I.I.shareLinksUploadDone(ie,k.c.joinPath(se,t))},a.getShareLinkRepoTags=function(){I.I.getShareLinkRepoTags(ie).then((function(e){var t=[];e.data.repo_tags.forEach((function(e){var i=new X.Z(e);i.fileCount>0&&t.push(i)})),a.setState({usedRepoTags:t}),0!=t.length&&"/"==oe&&a.setState({isRepoInfoBarShow:!0})})).catch((function(e){var t=k.c.getErrorMsg(e);C.Z.danger(t)}))},a.state={isLoading:!0,errorMsg:"",items:[],isAllItemsSelected:!1,selectedItems:[],sortBy:"name",sortOrder:"asc",isZipDialogOpen:!1,zipFolderPath:"",usedRepoTags:[],isRepoInfoBarShow:!1,isSaveSharedDirDialogShow:!1,itemsForSave:[],asyncCopyMoveTaskId:"",asyncOperationProgress:0,asyncOperatedFilesLength:0,isCopyMoveProgressDialogShow:!1,isImagePopupOpen:!1,imageItems:[],imageIndex:0},a}return(0,r.Z)(i,[{key:"componentDidMount",value:function(){var e=this;he&&C.Z.danger((0,F.ih)("File download is disabled: the share link traffic of owner is used up."),{duration:3}),I.I.listSharedDir(ie,oe,ce).then((function(t){var i=t.data.dirent_list.map((function(e){return e.isSelected=!1,e}));e.setState({isLoading:!1,errorMsg:"",items:k.c.sortDirentsInSharedDir(i,e.state.sortBy,e.state.sortOrder)}),e.getThumbnails()})).catch((function(t){var i=k.c.getErrorMsg(t);e.setState({isLoading:!1,errorMsg:i})})),this.getShareLinkRepoTags()}},{key:"getAsyncCopyMoveProgress",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,i,s,n,r,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.asyncCopyMoveTaskId,e.prev=1,e.next=4,I.I.queryAsyncOperationProgress(t);case 4:if(i=e.sent,!(s=i.data).failed){e.next=11;break}return n=(0,F.ih)("Failed to copy files to another library."),C.Z.danger(n),this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1}),e.abrupt("return");case 11:if(!s.successful){e.next=16;break}return this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1}),r=(0,F.ih)("Successfully copied files to another library."),C.Z.success(r),e.abrupt("return");case 16:o=s.total?parseInt((s.done/s.total*100).toFixed(2)):0,this.getAsyncCopyMoveProgress(),this.setState({asyncOperationProgress:o}),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),this.setState({asyncOperationProgress:0,isCopyMoveProgressDialogShow:!1});case 24:case"end":return e.stop()}}),e,this,[[1,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=k.c.isDesktop(),i="btn btn-secondary btn-icon sf-view-mode-btn";return(0,L.jsxs)(d.Fragment,{children:[(0,L.jsxs)("div",{className:"h-100 d-flex flex-column",children:[(0,L.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[(0,L.jsx)("a",{href:F.ze,children:(0,L.jsx)("img",{src:F.si+F.j1,height:F.AN,width:F.Bv,title:F.y7,alt:"logo"})}),ee&&(0,L.jsx)(S.Z,{})]}),(0,L.jsx)("div",{className:"o-auto",children:(0,L.jsxs)("div",{className:"shared-dir-view-main",children:[(0,L.jsx)("h2",{className:"h3",children:ae}),(0,L.jsxs)("p",{children:[(0,F.ih)("Shared by: "),ne]}),(0,L.jsxs)("div",{className:"d-flex justify-content-between align-items-center op-bar",children:[(0,L.jsxs)("p",{className:"m-0 mr-4 ellipsis d-flex align-items-center",children:[(0,L.jsx)("span",{className:"flex-none",children:(0,F.ih)("Current path: ")}),this.renderPath()]}),(0,L.jsxs)("div",{className:"flex-none",children:[t&&(0,L.jsxs)("div",{className:"view-mode btn-group",children:[(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(oe),"&mode=list"),className:"".concat(i," sf2-icon-list-view ").concat("list"==le?"current-mode":""),title:(0,F.ih)("List"),"aria-label":(0,F.ih)("List")}),(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(oe),"&mode=grid"),className:"".concat(i," sf2-icon-grid-view ").concat("grid"==le?"current-mode":""),title:(0,F.ih)("Grid"),"aria-label":(0,F.ih)("Grid")})]}),me&&(0,L.jsx)(m.Z,{disabled:ue,title:ue?(0,F.ih)("The owner of this library has run out of space."):"",onClick:this.onUploadFile,className:"ml-2 shared-dir-op-btn shared-dir-upload-btn",children:(0,F.ih)("Upload")}),fe&&(0,L.jsx)(d.Fragment,{children:this.state.items.some((function(e){return e.isSelected}))?(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)(m.Z,{color:"success",onClick:this.zipDownloadSelectedItems,className:"ml-2 shared-dir-op-btn",children:(0,F.ih)("ZIP Selected Items")}),pe&&ee&&ee!==ne&&(0,L.jsx)(m.Z,{color:"success",onClick:this.saveSelectedItems,className:"ml-2 shared-dir-op-btn",children:(0,F.ih)("Save Selected Items")})]}):(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)(m.Z,{color:"success",onClick:this.zipDownloadFolder.bind(this,oe),className:"ml-2 shared-dir-op-btn",children:(0,F.ih)("ZIP")}),pe&&ee&&ee!==ne&&(0,L.jsx)(m.Z,{color:"success",onClick:this.saveAllItems,className:"ml-2 shared-dir-op-btn",children:(0,F.ih)("Save")})]})})]})]}),!ue&&me&&(0,L.jsx)(q,{ref:function(t){return e.uploader=t},dragAndDrop:!1,token:ie,path:"/"===se?se:se.replace(/\/+$/,""),relativePath:"/"===oe?oe:oe.replace(/\/+$/,""),repoID:re,onFileUploadSuccess:this.onFileUploadSuccess}),this.state.isRepoInfoBarShow&&(0,L.jsx)(K.Z,{repoID:re,currentPath:"/",usedRepoTags:this.state.usedRepoTags,shareLinkToken:ie,enableFileDownload:fe,className:"mx-0"}),(0,L.jsx)(xe,{isDesktop:t,isLoading:this.state.isLoading,errorMsg:this.state.errorMsg,items:this.state.items,sortBy:this.state.sortBy,sortOrder:this.state.sortOrder,sortItems:this.sortItems,isAllItemsSelected:this.state.isAllItemsSelected,toggleAllSelected:this.toggleAllSelected,toggleItemSelected:this.toggleItemSelected,zipDownloadFolder:this.zipDownloadFolder,showImagePopup:this.showImagePopup})]})})]}),this.state.isZipDialogOpen&&(0,L.jsx)(D.Z,{children:(0,L.jsx)(y.Z,{token:ie,path:this.state.zipFolderPath,target:this.state.selectedItems,toggleDialog:this.closeZipDialog})}),this.state.isSaveSharedDirDialogShow&&(0,L.jsx)(J,{sharedToken:ie,parentDir:oe,items:this.state.itemsForSave,toggleCancel:this.toggleSaveSharedDirCancel,handleSaveSharedDir:this.handleSaveSharedDir}),this.state.isCopyMoveProgressDialogShow&&(0,L.jsx)($.Z,{type:"copy",asyncOperatedFilesLength:this.state.asyncOperatedFilesLength,asyncOperationProgress:this.state.asyncOperationProgress,toggleDialog:this.onProgressDialogToggle}),this.state.isImagePopupOpen&&(0,L.jsx)(D.Z,{children:(0,L.jsx)(Z.Z,{imageItems:this.state.imageItems,imageIndex:this.state.imageIndex,closeImagePopup:this.closeImagePopup,moveToPrevImage:this.moveToPrevImage,moveToNextImage:this.moveToNextImage})})]})}}]),i}(d.Component),xe=function(e){(0,l.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).sortByName=function(e){e.preventDefault();var t="asc"==a.props.sortOrder?"desc":"asc";a.props.sortItems("name",t)},a.sortByTime=function(e){e.preventDefault();var t="asc"==a.props.sortOrder?"desc":"asc";a.props.sortItems("time",t)},a.sortBySize=function(e){e.preventDefault();var t="asc"==a.props.sortOrder?"desc":"asc";a.props.sortItems("size",t)},a}return(0,r.Z)(i,[{key:"render",value:function(){var e=this,t=this.props,i=t.isDesktop,a=t.isLoading,s=t.errorMsg,n=t.items,r=t.sortBy,o=t.sortOrder,l=t.isAllItemsSelected;if(a)return(0,L.jsx)(w.Z,{});if(s)return(0,L.jsx)("p",{className:"error mt-6 text-center",children:s});var c=(0,L.jsx)("tbody",{children:n.map((function(t,a){return(0,L.jsx)(je,{isDesktop:i,item:t,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup,toggleItemSelected:e.props.toggleItemSelected},a)}))});if(!i)return(0,L.jsxs)("table",{className:"table-hover table-thead-hidden",children:[(0,L.jsx)("thead",{children:(0,L.jsxs)("tr",{children:[(0,L.jsx)("th",{width:"12%"}),(0,L.jsx)("th",{width:"80%"}),(0,L.jsx)("th",{width:"8%"})]})}),c]});var d=(0,L.jsx)("span",{className:"fas ".concat("asc"==o?"fa-caret-up":"fa-caret-down")});return"list"==le?(0,L.jsxs)("table",{className:"table-hover",children:[(0,L.jsx)("thead",{children:(0,L.jsxs)("tr",{children:[fe&&(0,L.jsx)("th",{width:"3%",className:"text-center",children:(0,L.jsx)("input",{type:"checkbox",checked:l,onChange:this.props.toggleAllSelected})}),(0,L.jsx)("th",{width:"5%"}),(0,L.jsx)("th",{width:fe?"50%":"53%",children:(0,L.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortByName,children:[(0,F.ih)("Name")," ","name"==r&&d]})}),(0,L.jsx)("th",{width:"8%"}),(0,L.jsx)("th",{width:"14%",children:(0,L.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortBySize,children:[(0,F.ih)("Size")," ","size"==r&&d]})}),(0,L.jsx)("th",{width:"13%",children:(0,L.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortByTime,children:[(0,F.ih)("Last Update")," ","time"==r&&d]})}),(0,L.jsx)("th",{width:"7%"})]})}),c]}):(0,L.jsx)("ul",{className:"grid-view",children:n.map((function(t,i){return(0,L.jsx)(be,{item:t,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup},i)}))})}}]),i}(d.Component),je=function(e){(0,l.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).toggleOpMenu=function(){a.setState({isOpMenuOpen:!a.state.isOpMenuOpen})},a.handleMouseOver=function(){a.setState({isIconShown:!0})},a.handleMouseOut=function(){a.setState({isIconShown:!1})},a.zipDownloadFolder=function(e){e.preventDefault(),a.props.zipDownloadFolder.bind((0,o.Z)(a),a.props.item.folder_path)()},a.handleFileClick=function(e){var t=a.props.item;k.c.imageCheck(t.file_name)&&(e.preventDefault(),a.props.showImagePopup(t))},a.toggleItemSelected=function(e){a.props.toggleItemSelected(a.props.item,e.target.checked)},a.state={isIconShown:!1,isOpMenuOpen:!1},a}return(0,r.Z)(i,[{key:"render",value:function(){var e=this.props,t=e.item,i=e.isDesktop,a=this.state.isIconShown,s="",n="";if(t.file_tags&&t.file_tags.length>0&&(s=p()(t.file_name).slice(0,7),n=t.file_tags.map((function(e){return e.tag_name})).join(" ")),t.is_dir)return i?(0,L.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[fe&&(0,L.jsx)("td",{className:"text-center",children:(0,L.jsx)("input",{type:"checkbox",checked:t.isSelected,onChange:this.toggleItemSelected})}),(0,L.jsx)("td",{className:"text-center",children:(0,L.jsx)("img",{src:k.c.getFolderIconUrl(),alt:"",width:"24"})}),(0,L.jsx)("td",{children:(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(le),children:t.folder_name})}),(0,L.jsx)("td",{}),(0,L.jsx)("td",{}),(0,L.jsx)("td",{title:b()(t.last_modified).format("llll"),children:b()(t.last_modified).fromNow()}),(0,L.jsx)("td",{children:fe&&(0,L.jsx)("a",{role:"button",className:"action-icon sf2-icon-download".concat(a?"":" invisible"),href:"#",onClick:this.zipDownloadFolder,title:(0,F.ih)("Download"),"aria-label":(0,F.ih)("Download")})})]}):(0,L.jsxs)("tr",{children:[(0,L.jsx)("td",{className:"text-center",children:(0,L.jsx)("img",{src:k.c.getFolderIconUrl(),alt:"",width:"24"})}),(0,L.jsxs)("td",{children:[(0,L.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(le),children:t.folder_name}),(0,L.jsx)("br",{}),(0,L.jsx)("span",{className:"item-meta-info",children:b()(t.last_modified).fromNow()})]}),(0,L.jsx)("td",{children:fe&&(0,L.jsxs)(g.Z,{isOpen:this.state.isOpMenuOpen,toggle:this.toggleOpMenu,children:[(0,L.jsx)(f.Z,{tag:"i",className:"sf-dropdown-toggle fa fa-ellipsis-v ml-0",title:(0,F.ih)("More operations"),"aria-label":(0,F.ih)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.isOpMenuOpen}),(0,L.jsxs)("div",{className:this.state.isOpMenuOpen?"":"d-none",onClick:this.toggleOpMenu,children:[(0,L.jsx)("div",{className:"mobile-operation-menu-bg-layer"}),(0,L.jsx)("div",{className:"mobile-operation-menu",children:(0,L.jsx)(v.Z,{className:"mobile-menu-item",onClick:this.zipDownloadFolder,children:(0,F.ih)("Download")})})]})]})})]});var r="".concat(F.ze,"d/").concat(ie,"/files/?p=").concat(encodeURIComponent(t.file_path)),o=t.encoded_thumbnail_src?"".concat(F.ze).concat(t.encoded_thumbnail_src):"";return i?(0,L.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[fe&&(0,L.jsx)("td",{className:"text-center",children:(0,L.jsx)("input",{type:"checkbox",checked:t.isSelected,onChange:this.toggleItemSelected})}),(0,L.jsx)("td",{className:"text-center",children:o?(0,L.jsx)("img",{className:"thumbnail",src:o,alt:""}):(0,L.jsx)("img",{src:k.c.getFileIconUrl(t.file_name),alt:"",width:"24"})}),(0,L.jsx)("td",{children:(0,L.jsx)("a",{href:r,onClick:this.handleFileClick,children:t.file_name})}),(0,L.jsx)("td",{className:"tag-list-title",children:t.file_tags&&t.file_tags.length>0&&(0,L.jsxs)(d.Fragment,{children:[(0,L.jsx)("div",{id:"tag-list-title-".concat(s),className:"dirent-item tag-list tag-list-stacked",children:t.file_tags.map((function(e,i){var a=t.file_tags.length;return(0,L.jsx)("span",{className:"file-tag",style:{zIndex:a-i,backgroundColor:e.tag_color}},e.file_tag_id)}))}),(0,L.jsx)(x.Z,{target:"tag-list-title-".concat(s),placement:"bottom",children:n})]})}),(0,L.jsx)("td",{children:k.c.bytesToSize(t.size)}),(0,L.jsx)("td",{title:b()(t.last_modified).format("llll"),children:b()(t.last_modified).fromNow()}),(0,L.jsx)("td",{children:fe&&(0,L.jsx)("a",{className:"action-icon sf2-icon-download".concat(a?"":" invisible"),href:"".concat(r,"&dl=1"),title:(0,F.ih)("Download"),"aria-label":(0,F.ih)("Download")})})]}):(0,L.jsxs)("tr",{children:[(0,L.jsx)("td",{className:"text-center",children:o?(0,L.jsx)("img",{className:"thumbnail",src:o,alt:""}):(0,L.jsx)("img",{src:k.c.getFileIconUrl(t.file_name),alt:"",width:"24"})}),(0,L.jsxs)("td",{children:[(0,L.jsx)("a",{href:r,onClick:this.handleFileClick,children:t.file_name}),(0,L.jsx)("br",{}),(0,L.jsx)("span",{className:"item-meta-info",children:k.c.bytesToSize(t.size)}),(0,L.jsx)("span",{className:"item-meta-info",children:b()(t.last_modified).fromNow()})]}),(0,L.jsx)("td",{children:fe&&(0,L.jsxs)(g.Z,{isOpen:this.state.isOpMenuOpen,toggle:this.toggleOpMenu,children:[(0,L.jsx)(f.Z,{tag:"i",className:"sf-dropdown-toggle fa fa-ellipsis-v ml-0",title:(0,F.ih)("More operations"),"aria-label":(0,F.ih)("More operations"),"data-toggle":"dropdown","aria-expanded":this.state.isOpMenuOpen}),(0,L.jsxs)("div",{className:this.state.isOpMenuOpen?"":"d-none",onClick:this.toggleOpMenu,children:[(0,L.jsx)("div",{className:"mobile-operation-menu-bg-layer"}),(0,L.jsx)("div",{className:"mobile-operation-menu",children:(0,L.jsx)(v.Z,{className:"mobile-menu-item",tag:"a",href:"".concat(r,"&dl=1"),children:(0,F.ih)("Download")})})]})]})})]})}}]),i}(d.Component),be=function(e){(0,l.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).handleMouseOver=function(){a.setState({isIconShown:!0})},a.handleMouseOut=function(){a.setState({isIconShown:!1})},a.zipDownloadFolder=function(e){e.preventDefault(),a.props.zipDownloadFolder.bind((0,o.Z)(a),a.props.item.folder_path)()},a.handleFileClick=function(e){var t=a.props.item;k.c.imageCheck(t.file_name)&&(e.preventDefault(),a.props.showImagePopup(t))},a.state={isIconShown:!1},a}return(0,r.Z)(i,[{key:"render",value:function(){var e=this.props.item,t=this.state.isIconShown;if(e.is_dir){var i="?p=".concat(encodeURIComponent(e.folder_path.substr(0,e.folder_path.length-1)),"&mode=").concat(le);return(0,L.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,L.jsx)("a",{href:i,className:"grid-file-img-link d-block",children:(0,L.jsx)("img",{src:k.c.getFolderIconUrl(!1,192),alt:"",width:"96",height:"96"})}),(0,L.jsx)("a",{href:i,className:"grid-file-name grid-file-name-link",children:e.folder_name}),fe&&(0,L.jsx)("a",{role:"button",className:"action-icon sf2-icon-download".concat(t?"":" invisible"),href:"#",onClick:this.zipDownloadFolder,title:(0,F.ih)("Download"),"aria-label":(0,F.ih)("Download")})]})}var a="".concat(F.ze,"d/").concat(ie,"/files/?p=").concat(encodeURIComponent(e.file_path)),s=e.encoded_thumbnail_src?"".concat(F.ze).concat(e.encoded_thumbnail_src):"";return(0,L.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[(0,L.jsx)("a",{href:a,className:"grid-file-img-link d-block",onClick:this.handleFileClick,children:s?(0,L.jsx)("img",{className:"thumbnail",src:s,alt:""}):(0,L.jsx)("img",{src:k.c.getFileIconUrl(e.file_name,192),alt:"",width:"96",height:"96"})}),(0,L.jsx)("a",{href:a,className:"grid-file-name grid-file-name-link",onClick:this.handleFileClick,children:e.file_name}),fe&&(0,L.jsx)("a",{className:"action-icon sf2-icon-download".concat(t?"":" invisible"),href:"".concat(a,"&dl=1"),title:(0,F.ih)("Download"),"aria-label":(0,F.ih)("Download")})]})}}]),i}(d.Component);u.render((0,L.jsx)(ve,{}),document.getElementById("wrapper"))},62012:function(){}},function(e){e.O(0,[351],(function(){return t=14472,e(e.s=t);var t}));e.O()}]);